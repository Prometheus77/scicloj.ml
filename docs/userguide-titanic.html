<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="https://stackpath.bootstrapcdn.com/bootswatch/4.5.0/sandstone/bootstrap.min.css" rel="stylesheet" type="text/css">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/styles/solarized-light.min.css" rel="stylesheet" type="text/css">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/ag-grid/24.0.0/styles/ag-grid.min.css" rel="stylesheet" type="text/css">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/ag-grid/24.0.0/styles/ag-theme-balham.min.css" rel="stylesheet" type="text/css">
        <link href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" rel="stylesheet" type="text/css">

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
        <!-- The loading of KaTeX is deferred to speed up page rendering -->
        <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
    </head>
    <body>
        <p id="loading">Loading ...</p>
        <div id="app"></div>
    </body>
    <script id="state" type="text">"{:options {:reverse-notes? false, :header? false, :notes-in-cards? false, :initially-collapse? false, :auto-scroll? false, :port 1903, :custom-header [:div {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} \"(notespace)\" [:p \"Mon Jun 14 17:13:26 CEST 2021\"] nil [:hr]], :custom-footer [:div [:hr] [:hr]]}, :ids [\"102\" \"103\" \"104\" \"105\" \"106\" \"107\" \"108\" \"109\" \"110\" \"111\" \"112\" \"113\" \"114\" \"115\" \"116\" \"117\" \"118\" \"119\" \"120\" \"121\" \"122\" \"123\" \"124\" \"125\" \"126\" \"127\" \"128\" \"129\" \"130\" \"131\" \"132\" \"133\" \"134\" \"135\" \"136\" \"137\" \"138\" \"139\" \"140\" \"141\" \"142\" \"143\" \"144\" \"145\" \"146\" \"147\" \"148\" \"149\" \"150\" \"151\" \"152\" \"153\" \"154\" \"155\" \"156\" \"157\" \"158\" \"159\" \"160\" \"161\" \"162\" \"163\" \"164\" \"165\" \"166\" \"167\" \"168\" \"169\" \"170\" \"171\" \"172\" \"173\" \"174\" \"175\" \"176\" \"177\" \"178\" \"179\" \"180\" \"181\" \"182\" \"183\" \"184\" \"185\" \"186\" \"187\" \"188\" \"189\" \"190\" \"191\" \"192\" \"193\" \"194\" \"195\" \"196\" \"197\" \"198\" \"199\" \"200\" \"201\"], :id->content {\"191\" [:div [:p] [:div [:p/code {:code \"(def models\\n  (->> evaluations\\n       flatten\\n       (map\\n        #(assoc\\n          (select-keys % [:mean :metric :fit-ctx])\\n          :model (ml/thaw-model (get-in % [:fit-ctx :model]))))\\n       (sort-by :metric)\\n       reverse))\", :bg-class \"bg-light\"}]] nil nil], \"180\" [:div [:p] [:div [:p/code {:code \"^kind/dataset\\n(->\\n (ml/confusion-map (:survived predictions)\\n                        (:survived trueth)\\n                        :none)\\n (ml/confusion-map->ds))\", :bg-class \"bg-light\"}]] nil [:div {:class \"table table-striped table-hover table-condensed table-responsive\", :style {:height \"230px\"}} [:p/markdown \"_unnamed [3 3]:\\n\\n| :column-name |  0 |  1 |\\n|--------------|----|----|\\n|  column-name |  0 |  1 |\\n|            0 | 82 | 15 |\\n|            1 | 22 | 60 |\\n\"]]], \"108\" [:div [:p] nil nil [:p/markdown \"Column names:\"]], \"188\" [:div [:p] nil nil [:p/markdown \"Evaluate all 10 pipelines and keep results\"]], \"158\" [:div [:p] nil nil [:p/markdown \"The pipeline definition\"]], \"201\" [:div [:p] [:div [:p/code {:code \"(-> best-model :fit-ctx :model :options)\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"{:trees 411.11111111111114,\\n :split-rule :entropy,\\n :max-depth 6.444444444444444,\\n :node-size 3.0,\\n :sample-rate 0.2,\\n :model-type :smile.classification/random-forest}\\n\"}]], \"141\" [:div [:p] [:div [:p/code {:code \"(def ctx\\n  (pipeline-fn\\n\\n   {:metamorph/data data}\\n   ))\", :bg-class \"bg-light\"}]] nil nil], \"139\" [:div [:p] [:div [:p/code {:code \"(def declartive-pipeline\\n  (ml/->pipeline\\n   pipe-ops\\n   ))\", :bg-class \"bg-light\"}]] nil nil], \"157\" [:div [:p] nil nil [:p/markdown \"We want to create a new column :title which might help in the score.\\nThis is an example of custom function, which creates a new column from existing columns,\\nwhich is a typical case of feature engineering.\"]], \"185\" [:div [:p] [:div [:p/code {:code \"(def search-grid\\n  (->>\\n   (ml/sobol-gridsearch {:trees (ml/linear 100 500 10)\\n                           :split-rule (ml/categorical [:gini :entropy])\\n                           :max-depth (ml/linear 1 50 10 )\\n                           :node-size (ml/linear 1 10 10)\\n                         :sample-rate (ml/linear 0.1 1 10)})\\n   (take 100))\\n  )\", :bg-class \"bg-light\"}]] nil nil], \"175\" [:div [:p] nil nil [:p/markdown \"We do this by running the pipeline again, this time with new data and merging\\n:mode transform\"]], \"155\" [:div [:p] [:div [:p/code {:code \"(def train-val-splits\\n    (ds/split->seq\\n     (:train-val ds-split)\\n     :kfold\\n     {:k 10}))\", :bg-class \"bg-light\"}]] nil nil], \"195\" [:div [:p] [:div [:p/code {:code \"(def best-model (first models))\", :bg-class \"bg-light\"}]] nil nil], \"118\" [:div [:p] [:div [:p/code {:code \"(def hist-fare\\n  (->>\\n   (stats/histogram (:fare data))\\n   :bins\\n   (map\\n    #(hash-map :a (Math/round (first %)) :b (second %))\\n    )\\n\\n   ))\", :bg-class \"bg-light\"}]] nil nil], \"193\" [:div [:p] [:div [:p/code {:code \"(count models)\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"1000\\n\"}]], \"105\" [:div [:p] nil nil [:p/markdown \" In this example, we will train a model which is able to predict the survival of passengers from the Titanic dataset.\\nIn a real analysis, this would contain as well explorative analysis of the data, which I will skip here,\\nas the purpose is to showcase machine learning with scicloj.ml, which is about model evaluation and selection.\"]], \"196\" [:div [:p] nil nil [:p/markdown \"which is: \"]], \"135\" [:div [:p] [:div [:p/code {:code \"(defn pprint-pipe-ops [pipe-ops]\\n  (run!\\n   (fn [ops]\\n     (run!\\n      (fn [p]\\n        (print (if  (fn? p)\\n                 (second (str/split (.getName (class p)) #\\\"\\\\$\\\" ))\\n                 p)\\n               \\\" \\\"))\\n      ops)\\n     (println))\\n   pipe-ops))\", :bg-class \"bg-light\"}]] nil nil], \"123\" [:div [:p] [:div [:p/code {:code \"^kind/vega\\n{:description \\\"A simple bar chart with embedded data.\\\"\\n :data {:values hist-simulated-fare}\\n ;; {:values [{:a \\\"A\\\" :b 28} {:a \\\"B\\\" :b 55} {:a \\\"C\\\" :b 43}\\n ;;           {:a \\\"D\\\" :b 91} {:a \\\"E\\\" :b 81} {:a \\\"F\\\" :b 53}\\n ;;           {:a \\\"G\\\" :b 19} {:a \\\"H\\\" :b 87} {:a \\\"I\\\" :b 52}]}\\n :mark        :bar\\n :encoding    {:x {:field :a :type :nominal :axis {:labelAngle 0}\\n                   }\\n               :y {:field :b :type :quantitative}}}\", :bg-class \"bg-light\"}]] nil [:p/vega {:description \"A simple bar chart with embedded data.\", :data {:values ({:b 179, :a 0} {:b 158, :a 7} {:b 111, :a 14} {:b 95, :a 22} {:b 63, :a 29} {:b 57, :a 36} {:b 43, :a 43} {:b 39, :a 51} {:b 35, :a 58} {:b 23, :a 65} {:b 15, :a 72} {:b 12, :a 79} {:b 12, :a 87} {:b 12, :a 94} {:b 6, :a 101} {:b 6, :a 108} {:b 5, :a 115} {:b 5, :a 123} {:b 2, :a 130} {:b 2, :a 137} {:b 2, :a 144} {:b 2, :a 151} {:b 2, :a 159} {:b 1, :a 166} {:b 0, :a 173} {:b 1, :a 180} {:b 2, :a 188} {:b 1, :a 195})}, :mark :bar, :encoding {:x {:field :a, :type :nominal, :axis {:labelAngle 0}}, :y {:field :b, :type :quantitative}}}]], \"116\" [:div [:p] nil nil [:p/markdown \"### Analyse distribution of :fare\"]], \"169\" [:div [:p] [:div [:p/code {:code \"(def models\\n  (->> evaluations\\n       flatten\\n       (map\\n        #(hash-map :model (ml/thaw-model (get-in % [:fit-ctx :model]))\\n                   :metric (:metric %)\\n                   :fit-ctx (:fit-ctx %)\\n                   ))\\n       (sort-by :mean)\\n       reverse))\", :bg-class \"bg-light\"}]] nil nil], \"179\" [:div [:p] [:div [:p/code {:code \"(def trueth\\n  (->\\n   (full-pipeline-fn {:metamorph/data (:test ds-split) :metamorph/mode :fit })\\n   :metamorph/data\\n   tech.v3.dataset.modelling/labels))\", :bg-class \"bg-light\"}]] nil nil], \"156\" [:div [:p] nil nil [:p/markdown \"### Use Pclass, Sex, title, age for prediction\"]], \"159\" [:div [:p] [:div [:p/code {:code \"(def full-pipeline-fn\\n  (ml/pipeline\\n   pipeline-fn\\n\\n   ;; we overwrite the id, so the model function will store\\n   ;; it's output (the model) in the pipeline ctx under key :model\\n   {:metamorph/id :model}\\n   (mm/model {:model-type :smile.classification/random-forest})))\", :bg-class \"bg-light\"}]] nil nil], \"162\" [:div [:p] nil nil [:p/markdown \"The default k-fold splits makes 10 folds,\\nso we train 10 models, each having its own loss.\"]], \"192\" [:div [:p] nil nil [:p/markdown \"As we did 10 pipelines and 10 fold cross validation, we have 100 models ttrained in total \"]], \"113\" [:div [:p] nil nil [:p/markdown \"Association between the select variables:\"]], \"167\" [:div [:p] nil nil [:p/markdown \"`tech.ml` stores the models in the context in a serialzed form,\\nand the function `thaw-model` can be used to get the original model back.\\nThis is a Java class in the case of\\n model :smile.classification/random.forest, but this depends on the\\nwhich `model` function is in the pipeline\"]], \"197\" [:div [:p] [:div [:p/code {:code \"(:model best-model)\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"#object[smile.classification.RandomForest 0x377ae2db \\\"smile.classification.RandomForest@377ae2db\\\"]\\n\"}]], \"107\" [:div [:p] [:div [:p/code {:code \"(def data (ds/dataset \\\"data/titanic/train.csv\\\" {:key-fn csk/->kebab-case-keyword}))\", :bg-class \"bg-light\"}]] nil nil], \"115\" [:div [:p] nil nil [:p/markdown \"In this dataset, :sex seems to be the best predictor for survival.\"]], \"111\" [:div [:p] [:div [:p/code {:code \"(def categorical-feature-columns [:pclass :sex :age :parch\\n                                    :embarked])\", :bg-class \"bg-light\"}]] nil nil], \"172\" [:div [:p] nil nil [:p/markdown \"The one with the highest accuracy is then:\"]], \"176\" [:div [:p] [:div [:p/code {:code \"(def predictions\\n  (->\\n   (full-pipeline-fn\\n    (assoc\\n     (:fit-ctx (first models))\\n     :metamorph/data (:test ds-split)\\n     :metamorph/mode :transform))\\n   :metamorph/data))\", :bg-class \"bg-light\"}]] nil nil], \"119\" [:div [:p] [:div [:p/code {:code \"^kind/vega\\n{:description \\\"A simple bar chart with embedded data.\\\"\\n :data {:values hist-fare}\\n ;; {:values [{:a \\\"A\\\" :b 28} {:a \\\"B\\\" :b 55} {:a \\\"C\\\" :b 43}\\n ;;           {:a \\\"D\\\" :b 91} {:a \\\"E\\\" :b 81} {:a \\\"F\\\" :b 53}\\n ;;           {:a \\\"G\\\" :b 19} {:a \\\"H\\\" :b 87} {:a \\\"I\\\" :b 52}]}\\n :mark        :bar\\n :encoding    {:x {:field :a :type :nominal :axis {:labelAngle 0}\\n                   }\\n               :y {:field :b :type :quantitative}}}\", :bg-class \"bg-light\"}]] nil [:p/vega {:description \"A simple bar chart with embedded data.\", :data {:values ({:b 16, :a 0} {:b 313, :a 5} {:b 109, :a 10} {:b 69, :a 14} {:b 40, :a 19} {:b 94, :a 24} {:b 45, :a 29} {:b 15, :a 34} {:b 19, :a 38} {:b 7, :a 43} {:b 18, :a 48} {:b 21, :a 53} {:b 6, :a 57} {:b 5, :a 62} {:b 12, :a 67} {:b 7, :a 72} {:b 21, :a 77} {:b 8, :a 81} {:b 9, :a 86} {:b 4, :a 91} {:b 0, :a 96} {:b 0, :a 101} {:b 4, :a 105} {:b 7, :a 110} {:b 0, :a 115} {:b 4, :a 120} {:b 0, :a 124} {:b 2, :a 129} {:b 5, :a 134} {:b 0, :a 139} {:b 2, :a 144} {:b 4, :a 148} {:b 3, :a 153} {:b 0, :a 158} {:b 2, :a 163} {:b 0, :a 168} {:b 0, :a 172} {:b 0, :a 177} {:b 0, :a 182} {:b 0, :a 187} {:b 0, :a 192} {:b 0, :a 196} {:b 0, :a 201} {:b 0, :a 206} {:b 4, :a 211} {:b 0, :a 215} {:b 1, :a 220} {:b 4, :a 225} {:b 0, :a 230} {:b 0, :a 235} {:b 0, :a 239} {:b 2, :a 244} {:b 0, :a 249} {:b 0, :a 254} {:b 6, :a 259} {:b 0, :a 263} {:b 0, :a 268} {:b 0, :a 273} {:b 0, :a 278} {:b 0, :a 282} {:b 0, :a 287} {:b 0, :a 292} {:b 0, :a 297} {:b 0, :a 302} {:b 0, :a 306} {:b 0, :a 311} {:b 0, :a 316} {:b 0, :a 321} {:b 0, :a 326} {:b 0, :a 330} {:b 0, :a 335} {:b 0, :a 340} {:b 0, :a 345} {:b 0, :a 350} {:b 0, :a 354} {:b 0, :a 359} {:b 0, :a 364} {:b 0, :a 369} {:b 0, :a 373} {:b 0, :a 378} {:b 0, :a 383} {:b 0, :a 388} {:b 0, :a 393} {:b 0, :a 397} {:b 0, :a 402} {:b 0, :a 407} {:b 0, :a 412} {:b 0, :a 417} {:b 0, :a 421} {:b 0, :a 426} {:b 0, :a 431} {:b 0, :a 436} {:b 0, :a 441} {:b 0, :a 445} {:b 0, :a 450} {:b 0, :a 455} {:b 0, :a 460} {:b 0, :a 464} {:b 0, :a 469} {:b 0, :a 474} {:b 0, :a 479} {:b 0, :a 484} {:b 0, :a 488} {:b 0, :a 493} {:b 0, :a 498} {:b 0, :a 503} {:b 3, :a 508})}, :mark :bar, :encoding {:x {:field :a, :type :nominal, :axis {:labelAngle 0}}, :y {:field :b, :type :quantitative}}}]], \"145\" [:div [:p] [:div [:p/code {:code \"(perc-survived-grouped (:categorical-ds ctx) :pclass)\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"({3 0.24236253} {1 0.6296296} {2 0.4728261})\\n\"}]], \"128\" [:div [:p] [:div [:p/code {:code \"(defn categorize-cabin [data]\\n  (-> data\\n      (ds/add-or-replace-column\\n       :cabin\\n       (map\\n        #(if (empty? %)\\n           :unknown\\n           (keyword (subs\\n                     %\\n                     0 1)))\\n        (:cabin data)\\n        ))))\", :bg-class \"bg-light\"}]] nil nil], \"199\" [:div [:p] nil nil [:p/markdown \"and a accuracy of \\n0.875\"]], \"186\" [:div [:p] nil nil [:p/markdown \"Generate the 10 pipeline-fn we want to evaluate.\"]], \"152\" [:div [:p] nil nil [:p/markdown \"The following splits the dataset in three pieces,\\n train, val and test to predict on later.\\n\"]], \"181\" [:div [:p] nil nil [:p/markdown \"### Hyper parameter tuning\"]], \"184\" [:div [:p] nil nil [:p/markdown \"Use sobol optimization, to find 10 grid points,\\nwhich cover in a smart way the hyper-parameter space.\"]], \"106\" [:div [:p] nil nil [:p/markdown \"### Read data\"]], \"173\" [:div [:p] [:div [:p/code {:code \"(-> models first :model )\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"#object[smile.classification.RandomForest 0x4b1d589 \\\"smile.classification.RandomForest@4b1d589\\\"]\\n\"}]], \"190\" [:div [:p] nil nil [:p/markdown \"Get the key information from the evaluations and sort by the metric function used,\\n accuracy here.\"]], \"112\" [:div [:p] [:div [:p/code {:code \"(map\\n #(hash-map\\n   %\\n   (stats/cramers-v-corrected\\n    (get  data %)\\n    (:survived data)\\n    ))\\n categorical-feature-columns\\n )\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"({:pclass 0.33668387622245516}\\n {:sex 0.5426213749215026}\\n {:age 0.16991560132000488}\\n {:parch 0.15693364431605167}\\n {:embarked 0.17309891006164452})\\n\"}]], \"148\" [:div [:p] [:div [:p/code {:code \"(perc-survived-grouped (:categorical-ds ctx) :cabin)\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"({:A 0.46666667}\\n {:F 0.61538464}\\n {:unknown 0.29985443}\\n {:D 0.75757575}\\n {:B 0.7446808}\\n {:T 0.0}\\n {:C 0.59322035}\\n {:E 0.75}\\n {:G 0.5})\\n\"}]], \"137\" [:div [:p] [:div [:p/code {:code \"(pprint-pipe-ops pipe-ops)\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"nil\\n\"}]], \"140\" [:div [:p] [:div [:p/code {:code \"(def ctx\\n  (declartive-pipeline\\n   {:metamorph/data data}\\n   ))\", :bg-class \"bg-light\"}]] nil nil], \"136\" [:div [:p] [:div [:p/code {:code \"(str/split \\\"a$b\\\" #\\\"\\\\$\\\")\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"[\\\"a\\\" \\\"b\\\"]\\n\"}]], \"166\" [:div [:p] nil nil [:p/markdown \"They controll as well which information is returned.\"]], \"121\" [:div [:p] [:div [:p/code {:code \"(def simulated-fare\\n (rnd/->seq (rnd/distribution :exponential {:mean 32}) 891)\\n  )\", :bg-class \"bg-light\"}]] nil nil], \"194\" [:div [:p] nil nil [:p/markdown \"As we sorted by mean accuracy, the first evaluation result is the best model,\"]], \"168\" [:div [:p] nil nil [:p/markdown \"We can get for example,  the models like this:\"]], \"154\" [:div [:p] nil nil [:p/markdown \"Create a sequence of train/test  (k-fold with k=10) splits used to evaluate the pipeline.\"]], \"110\" [:div [:p] nil nil [:p/markdown \"We can explore teh association between the categorical columns of the dataset\\nwith the :survived using cramers-v-corrected:\"]], \"174\" [:div [:p] nil nil [:p/markdown \"We can get the predictions on new-data, which for classification contain as well\\nthe posterior probabilities per class.\"]], \"171\" [:div [:p] [:div [:p/code {:code \"(-> models first :metric )\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"0.8472222222222222\\n\"}]], \"130\" [:div [:p] [:div [:p/code {:code \"(defn name->title [dataset]\\n  (-> dataset\\n      (ds/add-or-replace-column\\n       :title\\n       (map\\n        #(-> % (str/split  #\\\"\\\\.\\\")\\n             first\\n             (str/split  #\\\"\\\\,\\\")\\n             last\\n             str/trim)\\n        (data :name)))\\n      (ds/drop-columns :name)))\", :bg-class \"bg-light\"}]] nil nil], \"200\" [:div [:p] nil nil [:p/markdown \"using options: \"]], \"183\" [:div [:p] [:div [:p/code {:code \"(defn make-pipeline-fn [options]\\n\\n  (ml/pipeline\\n   pipeline-fn\\n   {:metamorph/id :model}\\n   (mm/model\\n    (merge options\\n           {:model-type :smile.classification/random-forest}))))\", :bg-class \"bg-light\"}]] nil nil], \"122\" [:div [:p] [:div [:p/code {:code \"(def hist-simulated-fare\\n  (->>\\n   (stats/histogram simulated-fare)\\n   :bins\\n   (map\\n    #(hash-map :a (Math/round (first %)) :b (second %))\\n    )\\n\\n   ))\", :bg-class \"bg-light\"}]] nil nil], \"149\" [:div [:p] [:div [:p/code {:code \"(map\\n\\n #(let [ds (:categorical-ds ctx)]\\n    (hash-map\\n     %\\n     (stats/cramers-v-corrected\\n      (get  ds %)\\n      (:survived ds)\\n      )))\\n [:sex :pclass :title :age-group :cabin]\\n )\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"({:sex 0.5426213749215026}\\n {:pclass 0.33668387622245516}\\n {:title 0.5642558304967829}\\n {:age-group 0.12736465647918094}\\n {:cabin 0.3200338586991885})\\n\"}]], \"120\" [:div [:p] [:div [:p/code {:code \"(def fare-best-ds\\n  (find-best\\n   (map\\n    inc\\n    (seq (:fare data)))\\n   :mle [:normal :exponential :levy :pareto :chi-squared]))\", :bg-class \"bg-light\"}]] nil nil], \"144\" [:div [:p] [:div [:p/code {:code \"(perc-survived-grouped (:categorical-ds ctx) :sex)\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"({\\\"male\\\" 0.18890814} {\\\"female\\\" 0.7420382})\\n\"}]], \"134\" [:div [:p] [:div [:p/code {:code \"(def pipe-ops [\\n  [mm/replace-missing :embarked :value \\\"S\\\"]\\n  [mm/replace-missing :age :value tech.v3.datatype.functional/mean]\\n  [ml/lift categorize-age]\\n  [ml/lift name->title]\\n  [ml/lift categorize-title]\\n  [ml/lift categorize-cabin]\\n  [mm/select-columns [:survived\\n                      :pclass\\n                      :age-group\\n                      :sex\\n                      :embarked\\n                      :title\\n                      :cabin]]\\n  ])\", :bg-class \"bg-light\"}]] nil nil], \"146\" [:div [:p] [:div [:p/code {:code \"(perc-survived-grouped (:categorical-ds ctx) :title)\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"({:mr 0.15667312}\\n {:mrs 0.792}\\n {:miss 0.7027027}\\n {:sir 0.47540984}\\n {:mme 1.0})\\n\"}]], \"177\" [:div [:p] [:div [:p/code {:code \"^kind/dataset\\npredictions\", :bg-class \"bg-light\"}]] nil [:div {:class \"table table-striped table-hover table-condensed table-responsive\", :style {:height \"400px\"}} [:p/markdown \":_unnamed [179 3]:\\n\\n|          0 |          1 | :survived |\\n|-----------:|-----------:|----------:|\\n| 0.37003291 | 0.62996709 |       1.0 |\\n| 0.39019372 | 0.60980628 |       1.0 |\\n| 0.76406604 | 0.23593396 |       0.0 |\\n| 0.27713353 | 0.72286647 |       1.0 |\\n| 0.58579524 | 0.41420476 |       0.0 |\\n| 0.76406604 | 0.23593396 |       0.0 |\\n| 0.44870911 | 0.55129089 |       1.0 |\\n| 0.77789500 | 0.22210500 |       0.0 |\\n| 0.75729464 | 0.24270536 |       0.0 |\\n| 0.35314281 | 0.64685719 |       1.0 |\\n| 0.78240379 | 0.21759621 |       0.0 |\\n| 0.59964320 | 0.40035680 |       0.0 |\\n| 0.78240379 | 0.21759621 |       0.0 |\\n| 0.76406604 | 0.23593396 |       0.0 |\\n| 0.75734010 | 0.24265990 |       0.0 |\\n| 0.41907961 | 0.58092039 |       1.0 |\\n| 0.27809639 | 0.72190361 |       1.0 |\\n| 0.44870911 | 0.55129089 |       1.0 |\\n| 0.42422247 | 0.57577753 |       1.0 |\\n| 0.77520592 | 0.22479408 |       0.0 |\\n| 0.73413037 | 0.26586963 |       0.0 |\\n| 0.76319570 | 0.23680430 |       0.0 |\\n| 0.76261073 | 0.23738927 |       0.0 |\\n| 0.78240379 | 0.21759621 |       0.0 |\\n| 0.26104253 | 0.73895747 |       1.0 |\\n\"]]], \"125\" [:div [:p] [:div [:p/code {:code \"(defn perc-survived-grouped [data col]\\n  (let [grouped\\n        (-> data\\n            (ds/group-by col {:result-type :as-map }))]\\n    (map\\n     (fn [[key ds]]\\n       {key (perc-survived ds)})\\n     grouped)))\", :bg-class \"bg-light\"}]] nil nil], \"104\" [:div [:p] nil nil [:p/markdown \"## Introduction \"]], \"102\" [:div [:p] [:div [:p/code {:code \"(comment\\n  (note/init-with-browser)\\n  (notespace.api/update-config\\n   #(assoc % :source-base-path \\\"userguide\\\"))\\n  (note/eval-this-notespace)\\n  (note/reread-this-notespace)\\n  (note/render-static-html \\\"docs/userguide-titanic.html\\\")\\n\\n  (note/init)\\n  )\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"nil\\n\"}]], \"165\" [:div [:p] nil nil [:p/markdown \"Return a single model only (as a list of 1) , namely the best over all\\n pipeline functions\\nand all cross validations is the default behavoiur, but can be changed\\nwith the `tune options`.\"]], \"153\" [:div [:p] [:div [:p/code {:code \"(def ds-split (first (ds/split->seq data :holdout {:ratio [0.8 0.2]\\n                                                   :split-names [:train-val :test]}\\n                                    )))\", :bg-class \"bg-light\"}]] nil nil], \"142\" [:div [:p] [:div [:p/code {:code \"^kind/dataset-grid\\n(:metamorph/data ctx)\", :bg-class \"bg-light\"}]] nil [:div {:class \"ag-theme-balham\", :style {:height \"150px\"}} [:p {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} [:small \"(showing at most 100 rows)\"]] [:p/dataset {:columnDefs [{:headerName \"survived\", :field \"survived\"} {:headerName \"pclass\", :field \"pclass\"} {:headerName \"age-group\", :field \"age-group\"} {:headerName \"sex\", :field \"sex\"} {:headerName \"embarked\", :field \"embarked\"} {:headerName \"title\", :field \"title\"} {:headerName \"cabin\", :field \"cabin\"}], :rowData ({\"survived\" 0, \"pclass\" 1, \"age-group\" 2, \"sex\" 0, \"embarked\" 1, \"title\" 4, \"cabin\" 2} {\"survived\" 1, \"pclass\" 0, \"age-group\" 2, \"sex\" 1, \"embarked\" 2, \"title\" 0, \"cabin\" 6} {\"survived\" 1, \"pclass\" 1, \"age-group\" 2, \"sex\" 1, \"embarked\" 1, \"title\" 2, \"cabin\" 2} {\"survived\" 1, \"pclass\" 0, \"age-group\" 2, \"sex\" 1, \"embarked\" 1, \"title\" 0, \"cabin\" 6} {\"survived\" 0, \"pclass\" 1, \"age-group\" 2, \"sex\" 0, \"embarked\" 1, \"title\" 4, \"cabin\" 2} {\"survived\" 0, \"pclass\" 1, \"age-group\" 2, \"sex\" 0, \"embarked\" 0, \"title\" 4, \"cabin\" 2} {\"survived\" 0, \"pclass\" 0, \"age-group\" 2, \"sex\" 0, \"embarked\" 1, \"title\" 4, \"cabin\" 7} {\"survived\" 0, \"pclass\" 1, \"age-group\" 3, \"sex\" 0, \"embarked\" 1, \"title\" 1, \"cabin\" 2} {\"survived\" 1, \"pclass\" 1, \"age-group\" 2, \"sex\" 1, \"embarked\" 1, \"title\" 0, \"cabin\" 2} {\"survived\" 1, \"pclass\" 2, \"age-group\" 4, \"sex\" 1, \"embarked\" 2, \"title\" 0, \"cabin\" 2} {\"survived\" 1, \"pclass\" 1, \"age-group\" 3, \"sex\" 1, \"embarked\" 1, \"title\" 2, \"cabin\" 8} {\"survived\" 1, \"pclass\" 0, \"age-group\" 2, \"sex\" 1, \"embarked\" 1, \"title\" 2, \"cabin\" 6} {\"survived\" 0, \"pclass\" 1, \"age-group\" 2, \"sex\" 0, \"embarked\" 1, \"title\" 4, \"cabin\" 2} {\"survived\" 0, \"pclass\" 1, \"age-group\" 2, \"sex\" 0, \"embarked\" 1, \"title\" 4, \"cabin\" 2} {\"survived\" 0, \"pclass\" 1, \"age-group\" 4, \"sex\" 1, \"embarked\" 1, \"title\" 2, \"cabin\" 2} {\"survived\" 1, \"pclass\" 2, \"age-group\" 2, \"sex\" 1, \"embarked\" 1, \"title\" 0, \"cabin\" 2} {\"survived\" 0, \"pclass\" 1, \"age-group\" 3, \"sex\" 0, \"embarked\" 0, \"title\" 1, \"cabin\" 2} {\"survived\" 1, \"pclass\" 2, \"age-group\" 2, \"sex\" 0, \"embarked\" 1, \"title\" 4, \"cabin\" 2} {\"survived\" 0, \"pclass\" 1, \"age-group\" 2, \"sex\" 1, \"embarked\" 1, \"title\" 0, \"cabin\" 2} {\"survived\" 1, \"pclass\" 1, \"age-group\" 2, \"sex\" 1, \"embarked\" 2, \"title\" 0, \"cabin\" 2} {\"survived\" 0, \"pclass\" 2, \"age-group\" 2, \"sex\" 0, \"embarked\" 1, \"title\" 4, \"cabin\" 2} {\"survived\" 1, \"pclass\" 2, \"age-group\" 2, \"sex\" 0, \"embarked\" 1, \"title\" 4, \"cabin\" 3} {\"survived\" 1, \"pclass\" 1, \"age-group\" 4, \"sex\" 1, \"embarked\" 0, \"title\" 2, \"cabin\" 2} {\"survived\" 1, \"pclass\" 0, \"age-group\" 2, \"sex\" 0, \"embarked\" 1, \"title\" 4, \"cabin\" 0} {\"survived\" 0, \"pclass\" 1, \"age-group\" 3, \"sex\" 1, \"embarked\" 1, \"title\" 2, \"cabin\" 2} {\"survived\" 1, \"pclass\" 1, \"age-group\" 2, \"sex\" 1, \"embarked\" 1, \"title\" 0, \"cabin\" 2} {\"survived\" 0, \"pclass\" 1, \"age-group\" 2, \"sex\" 0, \"embarked\" 2, \"title\" 4, \"cabin\" 2} {\"survived\" 0, \"pclass\" 0, \"age-group\" 2, \"sex\" 0, \"embarked\" 1, \"title\" 4, \"cabin\" 6} {\"survived\" 1, \"pclass\" 1, \"age-group\" 2, \"sex\" 1, \"embarked\" 0, \"title\" 2, \"cabin\" 2} {\"survived\" 0, \"pclass\" 1, \"age-group\" 2, \"sex\" 0, \"embarked\" 1, \"title\" 4, \"cabin\" 2} {\"survived\" 0, \"pclass\" 0, \"age-group\" 2, \"sex\" 0, \"embarked\" 2, \"title\" 1, \"cabin\" 2} {\"survived\" 1, \"pclass\" 0, \"age-group\" 2, \"sex\" 1, \"embarked\" 2, \"title\" 0, \"cabin\" 4} {\"survived\" 1, \"pclass\" 1, \"age-group\" 2, \"sex\" 1, \"embarked\" 0, \"title\" 2, \"cabin\" 2} {\"survived\" 0, \"pclass\" 2, \"age-group\" 0, \"sex\" 0, \"embarked\" 1, \"title\" 4, \"cabin\" 2} {\"survived\" 0, \"pclass\" 0, \"age-group\" 2, \"sex\" 0, \"embarked\" 2, \"title\" 4, \"cabin\" 2} {\"survived\" 0, \"pclass\" 0, \"age-group\" 2, \"sex\" 0, \"embarked\" 1, \"title\" 4, \"cabin\" 2} {\"survived\" 1, \"pclass\" 1, \"age-group\" 2, \"sex\" 0, \"embarked\" 2, \"title\" 4, \"cabin\" 2} {\"survived\" 0, \"pclass\" 1, \"age-group\" 2, \"sex\" 0, \"embarked\" 1, \"title\" 4, \"cabin\" 2} {\"survived\" 0, \"pclass\" 1, \"age-group\" 2, \"sex\" 1, \"embarked\" 1, \"title\" 2, \"cabin\" 2} {\"survived\" 1, \"pclass\" 1, \"age-group\" 4, \"sex\" 1, \"embarked\" 2, \"title\" 2, \"cabin\" 2} {\"survived\" 0, \"pclass\" 1, \"age-group\" 2, \"sex\" 1, \"embarked\" 1, \"title\" 0, \"cabin\" 2} {\"survived\" 0, \"pclass\" 2, \"age-group\" 2, \"sex\" 1, \"embarked\" 1, \"title\" 0, \"cabin\" 2} {\"survived\" 0, \"pclass\" 1, \"age-group\" 2, \"sex\" 0, \"embarked\" 2, \"title\" 4, \"cabin\" 2} {\"survived\" 1, \"pclass\" 2, \"age-group\" 3, \"sex\" 1, \"embarked\" 2, \"title\" 2, \"cabin\" 2} {\"survived\" 1, \"pclass\" 1, \"age-group\" 2, \"sex\" 1, \"embarked\" 0, \"title\" 2, \"cabin\" 2} {\"survived\" 0, \"pclass\" 1, \"age-group\" 2, \"sex\" 0, \"embarked\" 1, \"title\" 4, \"cabin\" 2} {\"survived\" 0, \"pclass\" 1, \"age-group\" 2, \"sex\" 0, \"embarked\" 0, \"title\" 4, \"cabin\" 2} {\"survived\" 1, \"pclass\" 1, \"age-group\" 2, \"sex\" 1, \"embarked\" 0, \"title\" 2, \"cabin\" 2} {\"survived\" 0, \"pclass\" 1, \"age-group\" 2, \"sex\" 0, \"embarked\" 2, \"title\" 4, \"cabin\" 2} {\"survived\" 0, \"pclass\" 1, \"age-group\" 2, \"sex\" 1, \"embarked\" 1, \"title\" 0, \"cabin\" 2} {\"survived\" 0, \"pclass\" 1, \"age-group\" 3, \"sex\" 0, \"embarked\" 1, \"title\" 1, \"cabin\" 2} {\"survived\" 0, \"pclass\" 1, \"age-group\" 2, \"sex\" 0, \"embarked\" 1, \"title\" 4, \"cabin\" 2} {\"survived\" 1, \"pclass\" 0, \"age-group\" 2, \"sex\" 1, \"embarked\" 2, \"title\" 0, \"cabin\" 3} {\"survived\" 1, \"pclass\" 2, \"age-group\" 2, \"sex\" 1, \"embarked\" 1, \"title\" 0, \"cabin\" 2} {\"survived\" 0, \"pclass\" 0, \"age-group\" 0, \"sex\" 0, \"embarked\" 2, \"title\" 4, \"cabin\" 4} {\"survived\" 1, \"pclass\" 0, \"age-group\" 2, \"sex\" 0, \"embarked\" 1, \"title\" 4, \"cabin\" 6} {\"survived\" 1, \"pclass\" 2, \"age-group\" 2, \"sex\" 1, \"embarked\" 1, \"title\" 2, \"cabin\" 2} {\"survived\" 0, \"pclass\" 1, \"age-group\" 2, \"sex\" 0, \"embarked\" 2, \"title\" 4, \"cabin\" 2} {\"survived\" 1, \"pclass\" 2, \"age-group\" 3, \"sex\" 1, \"embarked\" 1, \"title\" 2, \"cabin\" 2} {\"survived\" 0, \"pclass\" 1, \"age-group\" 4, \"sex\" 0, \"embarked\" 1, \"title\" 1, \"cabin\" 2} {\"survived\" 0, \"pclass\" 1, \"age-group\" 2, \"sex\" 0, \"embarked\" 2, \"title\" 4, \"cabin\" 2} {\"survived\" 1, \"pclass\" 0, \"age-group\" 2, \"sex\" 1, \"embarked\" 1, \"title\" 2, \"cabin\" 4} {\"survived\" 0, \"pclass\" 0, \"age-group\" 2, \"sex\" 0, \"embarked\" 1, \"title\" 4, \"cabin\" 6} {\"survived\" 0, \"pclass\" 1, \"age-group\" 3, \"sex\" 0, \"embarked\" 1, \"title\" 1, \"cabin\" 2} {\"survived\" 0, \"pclass\" 0, \"age-group\" 2, \"sex\" 0, \"embarked\" 2, \"title\" 4, \"cabin\" 2} {\"survived\" 1, \"pclass\" 1, \"age-group\" 2, \"sex\" 0, \"embarked\" 2, \"title\" 1, \"cabin\" 2} {\"survived\" 1, \"pclass\" 2, \"age-group\" 2, \"sex\" 1, \"embarked\" 1, \"title\" 0, \"cabin\" 1} {\"survived\" 0, \"pclass\" 1, \"age-group\" 2, \"sex\" 0, \"embarked\" 1, \"title\" 4, \"cabin\" 2} {\"survived\" 1, \"pclass\" 1, \"age-group\" 4, \"sex\" 1, \"embarked\" 1, \"title\" 2, \"cabin\" 2} {\"survived\" 0, \"pclass\" 1, \"age-group\" 2, \"sex\" 0, \"embarked\" 1, \"title\" 4, \"cabin\" 2} {\"survived\" 0, \"pclass\" 2, \"age-group\" 2, \"sex\" 0, \"embarked\" 1, \"title\" 4, \"cabin\" 2} {\"survived\" 0, \"pclass\" 1, \"age-group\" 4, \"sex\" 1, \"embarked\" 1, \"title\" 2, \"cabin\" 2} {\"survived\" 0, \"pclass\" 2, \"age-group\" 2, \"sex\" 0, \"embarked\" 1, \"title\" 4, \"cabin\" 2} {\"survived\" 0, \"pclass\" 1, \"age-group\" 2, \"sex\" 0, \"embarked\" 2, \"title\" 4, \"cabin\" 2} {\"survived\" 1, \"pclass\" 1, \"age-group\" 2, \"sex\" 0, \"embarked\" 1, \"title\" 4, \"cabin\" 2} {\"survived\" 0, \"pclass\" 1, \"age-group\" 2, \"sex\" 0, \"embarked\" 1, \"title\" 4, \"cabin\" 1} {\"survived\" 0, \"pclass\" 1, \"age-group\" 2, \"sex\" 0, \"embarked\" 1, \"title\" 4, \"cabin\" 2} {\"survived\" 0, \"pclass\" 1, \"age-group\" 2, \"sex\" 0, \"embarked\" 1, \"title\" 4, \"cabin\" 2} {\"survived\" 1, \"pclass\" 2, \"age-group\" 3, \"sex\" 0, \"embarked\" 1, \"title\" 1, \"cabin\" 2} {\"survived\" 1, \"pclass\" 1, \"age-group\" 2, \"sex\" 1, \"embarked\" 1, \"title\" 2, \"cabin\" 2} {\"survived\" 0, \"pclass\" 1, \"age-group\" 2, \"sex\" 0, \"embarked\" 1, \"title\" 4, \"cabin\" 2} {\"survived\" 1, \"pclass\" 1, \"age-group\" 2, \"sex\" 0, \"embarked\" 1, \"title\" 4, \"cabin\" 2} {\"survived\" 1, \"pclass\" 1, \"age-group\" 2, \"sex\" 1, \"embarked\" 0, \"title\" 2, \"cabin\" 2} {\"survived\" 0, \"pclass\" 0, \"age-group\" 2, \"sex\" 0, \"embarked\" 1, \"title\" 4, \"cabin\" 2} {\"survived\" 1, \"pclass\" 2, \"age-group\" 4, \"sex\" 1, \"embarked\" 1, \"title\" 2, \"cabin\" 2} {\"survived\" 1, \"pclass\" 1, \"age-group\" 2, \"sex\" 1, \"embarked\" 1, \"title\" 0, \"cabin\" 2} {\"survived\" 0, \"pclass\" 1, \"age-group\" 4, \"sex\" 0, \"embarked\" 1, \"title\" 4, \"cabin\" 2} {\"survived\" 0, \"pclass\" 1, \"age-group\" 2, \"sex\" 0, \"embarked\" 1, \"title\" 4, \"cabin\" 2} {\"survived\" 1, \"pclass\" 0, \"age-group\" 2, \"sex\" 1, \"embarked\" 1, \"title\" 2, \"cabin\" 6} {\"survived\" 0, \"pclass\" 1, \"age-group\" 2, \"sex\" 0, \"embarked\" 1, \"title\" 4, \"cabin\" 2} {\"survived\" 0, \"pclass\" 1, \"age-group\" 2, \"sex\" 0, \"embarked\" 1, \"title\" 4, \"cabin\" 2} {\"survived\" 0, \"pclass\" 1, \"age-group\" 2, \"sex\" 0, \"embarked\" 1, \"title\" 4, \"cabin\" 2} {\"survived\" 0, \"pclass\" 0, \"age-group\" 2, \"sex\" 0, \"embarked\" 1, \"title\" 4, \"cabin\" 7} {\"survived\" 0, \"pclass\" 1, \"age-group\" 2, \"sex\" 0, \"embarked\" 1, \"title\" 4, \"cabin\" 2} {\"survived\" 0, \"pclass\" 1, \"age-group\" 2, \"sex\" 0, \"embarked\" 1, \"title\" 4, \"cabin\" 2} {\"survived\" 0, \"pclass\" 1, \"age-group\" 2, \"sex\" 0, \"embarked\" 1, \"title\" 4, \"cabin\" 2} {\"survived\" 0, \"pclass\" 0, \"age-group\" 0, \"sex\" 0, \"embarked\" 2, \"title\" 4, \"cabin\" 0} {\"survived\" 1, \"pclass\" 0, \"age-group\" 2, \"sex\" 0, \"embarked\" 2, \"title\" 4, \"cabin\" 3} {\"survived\" 1, \"pclass\" 2, \"age-group\" 2, \"sex\" 1, \"embarked\" 1, \"title\" 0, \"cabin\" 2} {\"survived\" 0, \"pclass\" 2, \"age-group\" 2, \"sex\" 0, \"embarked\" 1, \"title\" 4, \"cabin\" 2})}]]], \"127\" [:div [:p] [:div [:p/code {:code \"(perc-survived-grouped data :sex)\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"({\\\"male\\\" 0.18890814} {\\\"female\\\" 0.7420382})\\n\"}]], \"109\" [:div [:p] [:div [:p/code {:code \"(ds/column-names data)\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"(:passenger-id\\n :survived\\n :pclass\\n :name\\n :sex\\n :age\\n :sib-sp\\n :parch\\n :ticket\\n :fare\\n :cabin\\n :embarked)\\n\"}]], \"124\" [:div [:p] [:div [:p/code {:code \"(defn perc-survived [data]\\n  (let [survived\\n        (-> data (ds/select-rows (comp #(= % 1) :survived)) ds/row-count)\\n        non-survived\\n        (-> data (ds/select-rows (comp #(= % 0) :survived)) ds/row-count)\\n        survived-perc (float (/ survived (+ survived non-survived)))\\n\\n        ]\\n    survived-perc\\n    )\\n  )\", :bg-class \"bg-light\"}]] nil nil], \"138\" [:div [:p] [:div [:p/code {:code \"(println\\n (class\\n  (first (first pipe-ops))))\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"nil\\n\"}]], \"114\" [:div [:p] [:div [:p/code {:code \"(for [c1 categorical-feature-columns c2 categorical-feature-columns]\\n  {[c1 c2]\\n   (stats/cramers-v-corrected (get data c1) (get data  c2))}\\n  )\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"({[:pclass :pclass] 1.0}\\n {[:pclass :sex] 0.1296896503052887}\\n {[:pclass :age] 0.3083742406780525}\\n {[:pclass :parch] 0.021952123038272046}\\n {[:pclass :embarked] 0.2637111024814829}\\n {[:sex :pclass] 0.12968965030528873}\\n {[:sex :sex] 0.9999999999999999}\\n {[:sex :age] 0.07314569623080924}\\n {[:sex :parch] 0.24710952428178493}\\n {[:sex :embarked] 0.1254672805309745}\\n {[:age :pclass] 0.3083742406780524}\\n {[:age :sex] 0.07314569623080973}\\n {[:age :age] 0.9999999999999996}\\n {[:age :parch] 0.2933617556368759}\\n {[:age :embarked] 0.24889228758508924}\\n {[:parch :pclass] 0.021952123038272067}\\n {[:parch :sex] 0.24710952428178493}\\n {[:parch :age] 0.2933617556368754}\\n {[:parch :parch] 0.9999999999999999}\\n {[:parch :embarked] 0.0}\\n {[:embarked :pclass] 0.2637111024814829}\\n {[:embarked :sex] 0.1254672805309745}\\n {[:embarked :age] 0.2488922875850892}\\n {[:embarked :parch] 0.0}\\n {[:embarked :embarked] 1.0})\\n\"}]], \"198\" [:div [:p] nil nil [:p/markdown \"with a mean accuracy of \\n0.7782986111111111\"]], \"133\" [:div [:p] [:div [:p/code {:code \"(def pipeline-fn\\n  (ml/pipeline\\n   (mm/replace-missing :embarked :value \\\"S\\\")\\n   (mm/replace-missing :age :value  tech.v3.datatype.functional/mean)\\n   (ml/lift categorize-age)\\n   (ml/lift name->title)\\n   (ml/lift categorize-title)\\n   (ml/lift categorize-cabin)\\n   (mm/select-columns [:survived\\n                       :pclass\\n                       :age-group\\n                       :sex\\n                       :embarked\\n                       :title\\n                       :cabin])\\n   (fn [ctx]\\n     (assoc ctx :categorical-ds\\n            (:metamorph/data ctx)\\n            ))\\n   (mm/categorical->number [:survived :pclass :sex :embarked\\n                            :title :age-group :cabin] {} :int64)\\n\\n   (mm/set-inference-target :survived)))\", :bg-class \"bg-light\"}]] nil nil], \"147\" [:div [:p] [:div [:p/code {:code \"(perc-survived-grouped (:categorical-ds ctx) :age-group)\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"({:adult 0.3643617}\\n {:child 0.61290324}\\n {:teen 0.4509804}\\n {:elderly 0.22727273}\\n {:other 0.5})\\n\"}]], \"151\" [:div [:p] [:div [:p/code {:code \"(let [ds (:categorical-ds ctx)]\\n  (stats/cramers-v-corrected\\n   (:sex ds )\\n   (:title ds)\\n   ))\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"0.9958829172933771\\n\"}]], \"182\" [:div [:p] nil nil [:p/markdown \"This defines a pipeline with options. The options gets passed to the model function,\\nso become hyper-parameters of the model.\\n\\nThe `use-age?` options is used to make a conditional pipeline. As the use-age? variable becomes part of the grid to search in,\\nwe tune it as well.\\nThis is an example how pipeline-options can be grid searched in the same way then hyper-parameters of the model.\\n\\n\"]], \"189\" [:div [:p] [:div [:p/code {:code \"(def evaluations\\n  (ml/evaluate-pipelines\\n   pipeline-fns\\n   train-val-splits\\n   ml/classification-accuracy\\n   :accuracy\\n   {:return-best-pipeline-only false\\n    :return-best-crossvalidation-only false\\n\\n    :map-fn :pmap\\n    :result-dissoc-seq []\\n    }\\n   ))\", :bg-class \"bg-light\"}]] nil nil], \"126\" [:div [:p] [:div [:p/code {:code \"(perc-survived-grouped data :pclass)\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"({3 0.24236253} {1 0.6296296} {2 0.4728261})\\n\"}]], \"143\" [:div [:p] nil nil [:p/markdown \"\"]], \"178\" [:div [:p] nil nil [:p/markdown \"Out of the predictions and the truth, we can construct the\\n confusion matrix.\"]], \"170\" [:div [:p] nil nil [:p/markdown \"The accuracy of the best trained model is:\"]], \"131\" [:div [:p] [:div [:p/code {:code \"(def title-map\\n  {\\\"Major\\\" :sir\\n   \\\"Col\\\" :sir\\n   \\\"Rev\\\" :sir\\n   \\\"Ms\\\" :miss\\n   \\\"Miss\\\" :miss\\n   \\\"Jonkheer\\\" :sir\\n   \\\"Don\\\" :sir\\n   \\\"Mlle\\\" :miss\\n   \\\"Mr\\\" :mr\\n   \\\"Master\\\" :sir\\n   \\\"Capt\\\" :sir\\n   \\\"Mrs\\\" :mrs\\n   \\\"Lady\\\" :mme\\n   \\\"Sir\\\" :sir\\n   \\\"Dr\\\" :sir\\n   \\\"the Countess\\\" :mme\\n   \\\"Mme\\\" :mme})\", :bg-class \"bg-light\"}]] nil nil], \"103\" [:div [:p] [:div [:p/code {:code \"(require '[scicloj.ml.dataset :as ds]\\n          '[tech.v3.dataset.math :as ds-math]\\n          '[tech.v3.datatype.functional :as dfn]\\n          '[scicloj.ml.core :as ml]\\n          '[scicloj.ml.metamorph :as mm]\\n          '[camel-snake-kebab.core :as csk]\\n          '[scicloj.metamorph.ml.loss :as loss]\\n          '[clojure.string :as str]\\n          '[fastmath.stats :as stats]\\n          '[fastmath.random :as rnd]\\n          '[fitdistr.core :as fit]\\n          )\", :bg-class \"bg-light\"}]] nil nil], \"161\" [:div [:p] [:div [:p/code {:code \"(def evaluations\\n  (ml/evaluate-pipelines\\n   [full-pipeline-fn]\\n   train-val-splits\\n   ml/classification-accuracy\\n   :accuracy))\", :bg-class \"bg-light\"}]] nil nil], \"129\" [:div [:p] [:div [:p/code {:code \"(defn categorize-age [data]\\n  (->\\n   data\\n   (ds/add-or-replace-column\\n    :age-group\\n    (map\\n     #(cond\\n        (< % 10) :child\\n        (< % 18) :teen\\n        (< % 60) :adult\\n        (> % 60) :elderly\\n        true :other)\\n     (:age data)))))\", :bg-class \"bg-light\"}]] nil nil], \"187\" [:div [:p] [:div [:p/code {:code \"(def pipeline-fns (map make-pipeline-fn search-grid))\", :bg-class \"bg-light\"}]] nil nil], \"164\" [:div [:p] nil nil [:p/markdown \"Often we consider the model with the lowest loss to be the best.\"]], \"163\" [:div [:p] nil nil [:p/markdown \"The `evaluate-pipelines` fn averages the models per pipe-fn,\\nand returns the best.\\nSo we get a single model back, as we only have one pipe fn\"]], \"160\" [:div [:p] nil nil [:p/markdown \"Evaluate the (single) pipeline function using the train/test split\"]], \"150\" [:div [:p] [:div [:p/code {:code \"(->>\\n (for [v1 [:sex :pclass :title :age-group :cabin :survived]\\n       v2 [:sex :pclass :title :age-group :cabin :survived]\\n       ]\\n\\n   (let [ds (:categorical-ds ctx)]\\n     (vector\\n      [v1 v2]\\n      (stats/cramers-v-corrected\\n       (get  ds v1)\\n       (get ds v2)\\n       )))\\n\\n\\n   )\\n (sort-by second)\\n reverse\\n )\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"([[:age-group :age-group] 1.0]\\n [[:title :title] 1.0]\\n [[:pclass :pclass] 1.0]\\n [[:survived :survived] 0.9999999999999999]\\n [[:cabin :cabin] 0.9999999999999999]\\n [[:sex :sex] 0.9999999999999999]\\n [[:sex :title] 0.9958829172933771]\\n [[:title :sex] 0.995882917293377]\\n [[:cabin :pclass] 0.5982689448346374]\\n [[:pclass :cabin] 0.5982689448346374]\\n [[:title :survived] 0.5642558304967829]\\n [[:survived :title] 0.5642558304967827]\\n [[:survived :sex] 0.5426213749215026]\\n [[:sex :survived] 0.5426213749215026]\\n [[:survived :pclass] 0.33668387622245516]\\n [[:pclass :survived] 0.33668387622245516]\\n [[:survived :cabin] 0.32003385869918854]\\n [[:cabin :survived] 0.3200338586991885]\\n [[:age-group :title] 0.28085125105157477]\\n [[:title :age-group] 0.28085125105157477]\\n [[:cabin :sex] 0.18247628444951258]\\n [[:sex :cabin] 0.18247628444951258]\\n [[:title :pclass] 0.14515889990934527]\\n [[:pclass :title] 0.14515889990934527]\\n [[:age-group :pclass] 0.14110047501155526]\\n [[:pclass :age-group] 0.14110047501155526]\\n [[:cabin :title] 0.13188671590515647]\\n [[:title :cabin] 0.13188671590515647]\\n [[:sex :pclass] 0.12968965030528873]\\n [[:pclass :sex] 0.1296896503052887]\\n [[:survived :age-group] 0.12736465647918097]\\n [[:age-group :survived] 0.12736465647918094]\\n [[:age-group :sex] 0.1070575105855414]\\n [[:sex :age-group] 0.1070575105855414]\\n [[:age-group :cabin] 0.09967802102204619]\\n [[:cabin :age-group] 0.09967802102204616])\\n\"}]], \"117\" [:div [:p] [:div [:p/code {:code \"(defn find-best\\n  [seq method ds]\\n  (let [selector (if (= method :mle) last first)]\\n    (dissoc (->> (map #(fit/fit method % seq {:stats #{:mle :ad :ks :cvm}}) ds)\\n                 (sort-by (comp method :stats))\\n                 (selector))\\n            :distribution)))\", :bg-class \"bg-light\"}]] nil nil], \"132\" [:div [:p] [:div [:p/code {:code \"(defn categorize-title [data]\\n(->\\n   data\\n   (ds/add-or-replace-column\\n    :title\\n    (map title-map (:title data)))))\", :bg-class \"bg-light\"}]] nil nil]}}"</script>
    <script src="gorilla-notes/js/compiled/main.js"></script>
</html>
