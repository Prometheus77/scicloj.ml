<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="https://stackpath.bootstrapcdn.com/bootswatch/4.5.0/sandstone/bootstrap.min.css" rel="stylesheet" type="text/css">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/styles/solarized-light.min.css" rel="stylesheet" type="text/css">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/ag-grid/24.0.0/styles/ag-grid.min.css" rel="stylesheet" type="text/css">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/ag-grid/24.0.0/styles/ag-theme-balham.min.css" rel="stylesheet" type="text/css">
        <link href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" rel="stylesheet" type="text/css">

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
        <!-- The loading of KaTeX is deferred to speed up page rendering -->
        <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
    </head>
    <body>
        <p id="loading">Loading ...</p>
        <div id="app"></div>
    </body>
    <script src="https://cdn.statically.io/gh/scicloj/gorilla-notes@master/dist/0.5.10/main.js"></script>
    <script>
     shadow.loader.load("main");
     gorilla_notes.main.main_BANG_(false, "{:options {:reverse-notes? false, :header? false, :notes-in-cards? false, :initially-collapse? false, :auto-scroll? false, :port 1903, :custom-header [:div {:style {:font-style \"italic\", :font-family \"\\\"Lucida Console\\\", Courier, monospace\"}} \"(notespace)\" [:p \"Fri Mar 19 16:47:45 CET 2021\"] nil [:hr]], :custom-footer [:div [:hr] [:hr]]}, :ids [\"951\" \"952\" \"900\" \"873\" \"924\" \"953\" \"874\" \"926\" \"370\" \"773\" \"774\" \"775\" \"465\" \"776\" \"777\" \"497\" \"846\" \"779\" \"927\" \"876\" \"954\" \"955\" \"956\" \"957\" \"905\" \"881\" \"958\" \"931\" \"959\" \"933\" \"960\" \"961\" \"962\" \"814\" \"936\" \"816\" \"885\" \"818\" \"854\" \"855\" \"856\" \"937\" \"963\" \"964\" \"965\" \"910\" \"966\" \"891\" \"967\" \"941\" \"942\" \"943\" \"915\" \"968\" \"969\" \"946\" \"837\" \"970\" \"971\" \"895\" \"972\"], :id->content {\"965\" [:div [:p] [:div [:p/code {:code \"(def titanic-test\\n  (->\\n   (ds/dataset \\\"https://github.com/scicloj/metamorph-examples/raw/main/data/titanic/test.csv\\\"\\n               {:key-fn keyword\\n                :parser-fn :string})\\n   (ds/add-column :Survived [\\\"0\\\"])))\", :bg-class \"bg-light\"}]] nil nil], \"955\" [:div [:p] [:div [:p/code {:code \"(def my-data\\n  (-> (ds/dataset \\\"https://raw.githubusercontent.com/techascent/tech.ml.dataset/master/test/data/stocks.csv\\\" {:key-fn keyword})\\n      (ds/select-columns [:symbol :price])\\n      (ds/add-or-replace-column :symbol (fn [ds] (map clojure.string/lower-case  (ds :symbol)) ))\\n      ))\", :bg-class \"bg-light\"}]] nil nil], \"370\" [:div [:p] nil nil [:p/markdown \"In the last 2 years the Clojure data science landscape was shaped\\nby the appearance and maturation of a new library to manage tabular data.\"]], \"941\" [:div [:p] nil nil [:p/markdown \"Now we have a trained model inside train-ctx. This is a usual map, so can be inspected in the repl.\"]], \"910\" [:div [:p] nil nil [:p/markdown \"Then we define the pipeline and it steps. Inside the pipeline we only use functions from namespace samskara.metamorph\"]], \"972\" [:div [:p] [:div [:p/code {:code \"(def trained-ctx\\n  (pipe-fn {:metamorph/data (:train reviews-split)\\n            :metamorph/mode :fit}))\", :bg-class \"bg-light\"}]] nil nil], \"885\" [:div [:p] nil nil [:p/markdown \"The setup for the following code needs a single dependencies in deps.edn or project.clj\"]], \"776\" [:div [:p] nil nil [:p/markdown \"## Models\"]], \"958\" [:div [:p] nil nil [:p/markdown \"Metamorph is documented here: [metamorph](https://github.com/scicloj/metamorph)\"]], \"927\" [:div [:p] nil nil [:p/markdown \"Clojure and the `tablecoth` library contains already the concept of running a  pipeline\"]], \"943\" [:div [:p] nil nil [:p/markdown \"We combine the previously obtained context (which contains the trained model)\\nwith the test data\"]], \"957\" [:div [:p] nil nil [:p/markdown \"\\n1. `->` is a macro, so we cannot compose pipelines easily\\n\\n2. We move a dataset object through the pipeline steps, so the only object we have nicely inside the pipeline, accessible to all steps, is the dataset itself.  But sometimes we need non-tabular, auxiliary data to be shared across the pipeline steps, which is not possible with passing a dataset only.Using this simple pipelines, would force to hold auxiliary data in a global state of some form.This makes is very hard to execute pipelines repeatedly, as they are not self-contained.\\n\\n3. This simple pipeline has no notion of running a pipeline in several modes. In machine learning a pipeline need to behave differently in `fit` and in `transform`. (often called `train` vs `predict`). The models learns from data in the `fit` and it applies what it has learned in `transform`.\\n\"]], \"818\" [:div [:p] nil nil [:p/markdown \"\\n{:deps {\\n        samskara/samskara {:mvn/version \\\"0.1.0\\\"}} }\\n\"]], \"953\" [:div [:p] nil nil [:p/markdown \"3. A standard way to express steps of data manipulations including train/predict of a model\"]], \"942\" [:div [:p] nil nil [:p/markdown \"Now we execute the pipeline in mode :transform,\\nwhich wil make a prediction \"]], \"777\" [:div [:p] nil nil [:p/markdown \"Models are the core of most machine learning libraries. In Samskara we rely on an common `abstraction` for all\\nmachine learning models and one Java library [Smile](https://github.com/haifengl/smile) providing models,\\nwhich we bridge into Clojure via the abstraction.\\nSo we use Java models internally, but without the need for Java\\ninterop by the user.\\n\\nDocumentation for existing models is appearing here:\\nhttps://behrica.github.io/samskara/userguide-models.html\\n\\nThe abstraction is independent from Smile, so we could makes bridges to other libraries, even in non JVM languages (python, R)\\n\\n\\n\"]], \"814\" [:div [:p] nil nil [:p/markdown \"[Smile](https://haifengl.github.io/) is a complete data science package for Java.\\nVarious smile models are made available to Clojure by `tech.ml.smile` \"]], \"954\" [:div [:p] [:div [:p/code {:code \"(require '[samskara.dataset :as ds])\", :bg-class \"bg-light\"}]] nil nil], \"837\" [:div [:p] nil nil [:p/markdown \"## More advanced use case, as we need to pass the vocab size betweenn steps\"]], \"924\" [:div [:p] nil nil [:p/markdown \"2. Various machine learning Models\"]], \"856\" [:div [:p] nil nil [:p/markdown \"To start we need to require a few namespaces\"]], \"876\" [:div [:p] nil nil [:p/markdown \"These simpler form of a pipeline in Clojure and Tablecloth, can just make use of the fact that all tablecloth functions take a dataset as\\n the first parameter and return a dataset. So they can be chained together with the pipe (`->`) operator of Clojure, example:\"]], \"497\" [:div [:p] nil nil [:p/markdown \"## Data transformation pipelines.\"]], \"969\" [:div [:p] [:div [:p/code {:code \"^kind/dataset\\n(:metamorph/data test-ctx)\", :bg-class \"bg-light\"}]] nil [:div {:class \"table table-striped table-hover table-condensed table-responsive\", :style {:height \"400px\"}} [:p/markdown \":_unnamed [418 3]:\\n\\n|       1 |       0 | :Survived |\\n|---------|---------|-----------|\\n|  0.1893 |  0.8107 |       1.0 |\\n|  0.7412 |  0.2588 |       0.0 |\\n|  0.1893 |  0.8107 |       1.0 |\\n|  0.1893 |  0.8107 |       1.0 |\\n|  0.7412 |  0.2588 |       0.0 |\\n|  0.1893 |  0.8107 |       1.0 |\\n|  0.7412 |  0.2588 |       0.0 |\\n|  0.1893 |  0.8107 |       1.0 |\\n|  0.7412 |  0.2588 |       0.0 |\\n|  0.1893 |  0.8107 |       1.0 |\\n|  0.1893 |  0.8107 |       1.0 |\\n|  0.1893 |  0.8107 |       1.0 |\\n|  0.7412 |  0.2588 |       0.0 |\\n|  0.1893 |  0.8107 |       1.0 |\\n|  0.7412 |  0.2588 |       0.0 |\\n|  0.7412 |  0.2588 |       0.0 |\\n|  0.1893 |  0.8107 |       1.0 |\\n|  0.1893 |  0.8107 |       1.0 |\\n|  0.7412 |  0.2588 |       0.0 |\\n|  0.7412 |  0.2588 |       0.0 |\\n|  0.1893 |  0.8107 |       1.0 |\\n|  0.1893 |  0.8107 |       1.0 |\\n|  0.7412 |  0.2588 |       0.0 |\\n|  0.1893 |  0.8107 |       1.0 |\\n|  0.7412 |  0.2588 |       0.0 |\\n\"]]], \"846\" [:div [:p] nil nil [:p/markdown \"In order to apply machine learning, the data needs to be transformed from its original form ,\\n(often as a data file), into the form required my the model.\\n Sometimes these transformation are simple, like chaining encoding, sometimes very complex.\\n In some contexts this is as well called feature engineering, which can result in arbitrary\\ncomplex dataset transformations.\\nThis transformations are dataset->dataset transformations.\\n\"]], \"873\" [:div [:p] nil nil [:p/markdown \"1. A standard way to manage tabular data in memory.\"]], \"936\" [:div [:p] nil nil [:p/markdown \"In order to give easier accesss to the variuos libraries, the Samskara  library was created.\\nIt unifies the access to the libaries above in three namespaces.\\n\"]], \"874\" [:div [:p] nil nil [:p/markdown \"The Clojure language and core libraries do not have build-in, specific support for this,\\nso some libraries are required. \"]], \"891\" [:div [:p] nil nil [:p/markdown \"Now we execute the pipeline in mode :fit,\\nwhich will as well train the model. \"]], \"960\" [:div [:p] nil nil [:p/markdown \"The Clojure ML ecosystem is based on different libraries working together, as\\nidiomatic in Clojure\"]], \"968\" [:div [:p] nil nil [:p/markdown \"Prediction:\"]], \"854\" [:div [:p] nil nil [:p/markdown \"This library acts as a facade to the four libraries above, and arranges the functions in a simple way in these namespaces:\"]], \"915\" [:div [:p] [:div [:p/code {:code \"(def test-ctx\\n  (pipe-fn\\n   (assoc trained-ctx\\n          :metamorph/data titanic-test\\n          :metamorph/mode :transform)))\", :bg-class \"bg-light\"}]] nil nil], \"970\" [:div [:p] [:div [:p/code {:code \"(def reviews\\n  (ds/dataset \\\"https://github.com/scicloj/metamorph-examples/raw/main/data/reviews.csv.gz\\\"\\n              {:key-fn keyword}))\", :bg-class \"bg-light\"}]] nil nil], \"966\" [:div [:p] [:div [:p/code {:code \"(def pipe-fn\\n  (ml/pipeline\\n   (mm/select-columns [:Survived :Sex ])\\n   (mm/categorical->number [:Survived :Sex])\\n   (mm/set-inference-target :Survived)\\n   (mm/model {:model-type :smile.classification/logistic-regression})))\", :bg-class \"bg-light\"}]] nil nil], \"779\" [:div [:p] nil nil [:p/markdown \"This pipelines need to be repeatable and self-contained, as they need to run several times\\nwith different data or in variants for either cross validation or hyper-parameter tuning.\"]], \"773\" [:div [:p] nil nil [:p/markdown \"This library is [tech.ml.dataset](https://github.com/techascent/tech.ml.dataset).\\n It defines a in-memory tabular data structure and operations on it. It is a remarkable piece of software,\\nhighly optimized and linking in its root to native memory and allow zero-copy integration's outside Clojure.\"]], \"895\" [:div [:p] [:div [:p/code {:code \"(def pipe-fn\\n  (ml/pipeline\\n   (mm/select-columns [:Text :Score ])\\n   (mm/count-vectorize :Text :bow)\\n   (mm/bow->sparse-array :bow :bow-sparse)\\n   (mm/set-inference-target :Score)\\n   (mm/select-columns [:bow-sparse :Score])\\n   (fn [ctx]\\n     (let [p (-> ctx :tech.v3.libs.smile.metamorph/count-vectorize-vocabulary\\n                 :vocab\\n                 count\\n                 )]\\n       ((mm/model {:p p\\n                   :model-type :smile.classification/maxent-multinomial\\n                   :sparse-column :bow-sparse})\\n        ctx)))\\n   ))\", :bg-class \"bg-light\"}]] nil nil], \"881\" [:div [:p] nil nil [:p/markdown \"It addresses all three shortcomings of the simpler pipeline.\"]], \"926\" [:div [:p] nil nil [:p/markdown \"## Representing training data\"]], \"855\" [:div [:p] nil nil [:p/markdown \"\\n\\n| namespace           | purpose                                                  |\\n|---------------------|----------------------------------------------------------|\\n| samskara.ml         | core functionality for machine learning                  |\\n| samskara.dataset    | functions to manipulate a dataset                        |\\n| samskara.methamorph | metamorph compliant functions to be used in ml pipelines |\\n\\n \"]], \"967\" [:div [:p] [:div [:p/code {:code \"(def trained-ctx\\n  (pipe-fn {:metamorph/data titanic-train\\n            :metamorph/mode :fit}))\", :bg-class \"bg-light\"}]] nil nil], \"774\" [:div [:p] nil nil [:p/markdown \"As it was organically growing over time, it's API is functional and complete,\\nbut lacks consistency in some parts.\\n\"]], \"971\" [:div [:p] [:div [:p/code {:code \"(def reviews-split\\n  (first\\n   (ds/split->seq reviews :holdout)))\", :bg-class \"bg-light\"}]] nil nil], \"937\" [:div [:p] [:div [:p/code {:code \"(require '[samskara.ml :as ml]\\n         '[samskara.metamorph :as mm]\\n         '[samskara.dataset :refer [dataset add-column] ]\\n         )\", :bg-class \"bg-light\"}]] nil nil], \"775\" [:div [:p] nil nil [:p/markdown \"This was addressed by an other library, layering on top of it, called `tablecloth`\\nIt is available [here](https://github.com/scicloj/tablecloth)\"]], \"963\" [:div [:p] nil nil [:p/markdown \"First we load the data.\"]], \"946\" [:div [:p] nil nil [:p/markdown \"The documentation of `mm/model` here https://behrica.github.io/samskara/samskara.metamorph.html#var-model\\ndocuments this special behavior of the function\"]], \"962\" [:div [:p] nil nil [:p/markdown \"\\n1. `tablecloth` for general manipulation of the dataset\\n1. `tech.v3.dataset` to finally prepare a dataset for the machine learing models\\n1.  `metamorph.ml` for running pipelines and machine learning core functions\\n1.  `tech.ml.smile` containing ML models and NLP functions based on Smile\\n\"]], \"816\" [:div [:p] nil nil [:p/markdown \"## Machine learning using Samskara\"]], \"905\" [:div [:p] nil nil [:p/markdown \"Due to this, the idea of the `metamorph` pipeline concept was born.\"]], \"900\" [:div [:p] nil nil [:p/markdown \"In order to practice machine learning and create an ecosystem of models around it,\\nwe need 3 component.\"]], \"951\" [:div [:p] [:div [:p/code {:code \"(comment\\n  (note/init-with-browser)\\n  (note/eval-this-notespace)\\n  (note/reread-this-notespace)\\n  (note/render-static-html \\\"docs/userguide-intro.html\\\")\\n  (note/init)\\n\\n(notespace.api/update-config\\n  #(assoc % :source-base-path \\\"userguide\\\"))\\n\\n  )\", :bg-class \"bg-light\"}]] nil [:p/code {:code \"nil\\n\"}]], \"933\" [:div [:p] nil nil [:p/markdown \"## Samskara\"]], \"961\" [:div [:p] nil nil [:p/markdown \"Four main libraries are used internally, to create a complete machine learning library,\\nbut this is hidden from the user, and is listed here only for completeness.\"]], \"952\" [:div [:p] nil nil [:p/markdown \"# Clojure and machine learning \"]], \"465\" [:div [:p] nil nil [:p/markdown \"So we have now a very reliable, mature, easy to use library to store and manipulate tabular data, including text.\"]], \"959\" [:div [:p] nil nil [:p/markdown \"Tablecloth contains such operations in the `tablecloth.pipeline` namespace. All functions of the `tablecloth.api` namespace are replicated there,\\n but metamorph compliant\"]], \"956\" [:div [:p] nil nil [:p/markdown \"This form of pipeline works to manipulate a dataset, but has three disadvantages.\"]], \"931\" [:div [:p] nil nil [:p/markdown \"As we see in the metamorph documentation, a pipeline can be composed of functions, which adhere to some simple standards\\nregarding input and output, as explained here: https://github.com/scicloj/metamorph#compliant-operations\"]], \"964\" [:div [:p] [:div [:p/code {:code \"(def titanic-train\\n  (ds/dataset \\\"https://github.com/scicloj/metamorph-examples/raw/main/data/titanic/train.csv\\\"\\n               {:key-fn keyword\\n               :parser-fn :string\\n                }))\", :bg-class \"bg-light\"}]] nil nil]}}");
     document.getElementById("loading").remove();
    </script>
</html>
